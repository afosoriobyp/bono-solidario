{% extends 'admin/layout.html' %}
{% block title %}Vendedor{% endblock %}
{% block admin_content %}
<div class="container mt-4">
  <h2>{{ 'Editar' if seller else 'Crear' }} Vendedor</h2>
  <form method="POST">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="identificacion" class="form-label">Identificación</label>
        <input type="text" class="form-control" id="identificacion" name="identificacion" value="{{ seller.identificacion if seller else '' }}">
      </div>
      <div class="col-md-6 mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="nombre" name="nombre" value="{{ seller.nombre if seller else '' }}" required>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="direccion" class="form-label">Dirección</label>
        <input type="text" class="form-control" id="direccion" name="direccion" value="{{ seller.direccion if seller else '' }}">
      </div>
      <div class="col-md-6 mb-3">
        <label for="telefono" class="form-label">Teléfono</label>
        <input type="text" class="form-control" id="telefono" name="telefono" value="{{ seller.telefono if seller else '' }}">
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" name="email" value="{{ seller.email if seller else '' }}" required>
      </div>
      <div class="col-md-6 mb-3 d-flex align-items-center">
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="tratamiento_datos" name="tratamiento_datos" value="1" {% if seller and seller.tratamiento_datos %}checked{% endif %}>
          <label class="form-check-label" for="tratamiento_datos">Acepta tratamiento de datos</label>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="estado" class="form-label">Estado</label>
        <select class="form-select" id="estado" name="estado">
          <option value="activo" {% if seller and seller.estado == 'activo' %}selected{% endif %}>Activo</option>
          <option value="inactivo" {% if seller and seller.estado == 'inactivo' %}selected{% endif %}>Inactivo</option>
        </select>
      </div>
      <div class="col-md-6 mb-3"></div>
    </div>

    <hr class="my-4 border-3 border-primary rounded-pill" style="opacity:0.5;">
    <div class="row">
      <div class="col">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="{{ url_for('admin.sellers') }}" class="btn btn-secondary ms-2">Cancelar</a>
      </div>
    </div>
  </form>
  <script>
    (function(){
      const form = document.currentScript && document.currentScript.previousElementSibling && document.currentScript.previousElementSibling.tagName === 'FORM'
        ? document.currentScript.previousElementSibling
        : document.querySelector('form');
      if (!form) return;

      // Selecciona inputs de texto y textareas; excluye email
      const inputs = form.querySelectorAll('input[type="text"], textarea');
      inputs.forEach(input => {
        input.addEventListener('input', (e) => {
          const el = e.target;
          const start = el.selectionStart;
          const end = el.selectionEnd;
          el.value = el.value.toUpperCase();
          try { el.setSelectionRange(start, end); } catch (err) {}
        });

        // Normalizar texto pegado
        input.addEventListener('paste', (e) => {
          e.preventDefault();
          const pasted = (e.clipboardData || window.clipboardData).getData('text');
          const text = pasted.toUpperCase();
          const el = e.target;
          const start = el.selectionStart;
          const end = el.selectionEnd;
          el.value = el.value.slice(0, start) + text + el.value.slice(end);
          const pos = start + text.length;
          try { el.setSelectionRange(pos, pos); } catch (err) {}
        });
      });
    })();
  </script>
</div>
{% endblock %}
